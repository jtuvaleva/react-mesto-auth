{"ast":null,"code":"var _jsxFileName = \"/Users/juliatuvaleva/Desktop/dev/mestoReact/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ImagePopup from './ImagePopup';\nimport ConfirmationPopup from './ConfirmationPopup';\nimport Register from './Register';\nimport Login from './Login';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\nimport React, { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport { api } from '../utils/api.js';\nimport { escKey } from '../utils/constant.js';\nimport * as auth from '../auth';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [cardsList, setCards] = useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isDeleteConfirmPopupOpen, setIsDeleteConfirmPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [selectedCardDelete, setSelectedCardDelete] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [isInfotooltipOpen, setisInfotooltipOpen] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const history = useHistory();\n  const [userEmail, setUserEmail] = useState(null);\n  useEffect(() => {\n    api.getProfileInfo().then(userData => {\n      setCurrentUser(userData);\n    }).catch(error => {\n      console.log(error);\n    });\n    api.getInitialCards().then(cardsData => {\n      setCards(cardsData);\n    }).catch(error => {\n      console.log(error);\n    });\n    checkToken();\n  }, []);\n  useEffect(() => {\n    const close = e => {\n      if (e.keyCode === escKey) {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener('keydown', close);\n    return () => document.removeEventListener('keydown', close);\n  }, []);\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteButtonClick(card) {\n    setIsDeleteConfirmPopupOpen(true);\n    setSelectedCardDelete(card);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsDeleteConfirmPopupOpen(false);\n    setIsImagePopupOpen(false);\n    setisInfotooltipOpen(false);\n  }\n\n  function handleUpdateUser(formData) {\n    api.editProfileInfo(formData).then(userData => {\n      setCurrentUser(userData);\n      setIsEditProfilePopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleUpdateAvatar(formLink) {\n    api.editProfilePhoto(formLink).then(userData => {\n      setCurrentUser(userData);\n      setIsEditAvatarPopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleAddPlaceSubmit(cardForm) {\n    api.addNewCard(cardForm).then(newCard => {\n      setCards([newCard, ...cardsList]);\n      setIsAddPlacePopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, !isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      setCards(cards => cards.filter(c => c._id !== card._id));\n      setIsDeleteConfirmPopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleLogin({\n    email,\n    password\n  }) {\n    auth.authorize(email, password).then(data => {\n      const jwt = data.token;\n      localStorage.setItem('jwt', jwt);\n      setLoggedIn(true);\n      setUserData(email);\n      history.push('/main');\n    }).catch(error => console.log(error));\n  }\n\n  function handleRegister({\n    password,\n    email\n  }) {\n    auth.register(password, email).then(res => {\n      if (res) {\n        setIsSuccess(true);\n        setisInfotooltipOpen(true);\n        history.push('/signin');\n      }\n    }).catch(error => {\n      setIsSuccess(false);\n      setisInfotooltipOpen(true);\n      console.log(error);\n    });\n  }\n\n  function checkToken() {\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getContent(jwt).then(data => {\n        if (data.email) {\n          setUserData(data.email);\n          setLoggedIn(true);\n          history.push('/main');\n        }\n      }).catch(error => console.log(error));\n    } // если у пользователя есть токен в localStorage, \n    // эта функция проверит, действующий он или нет\n\n\n    if (localStorage.getItem('jwt')) {\n      const jwt = localStorage.getItem('jwt'); // здесь будем проверять токен\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/signup\",\n        children: /*#__PURE__*/_jsxDEV(Register, {\n          handleRegister: handleRegister\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/signin\",\n        children: /*#__PURE__*/_jsxDEV(Login, {\n          handleLogin: handleLogin\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Main, {\n        exact: true,\n        path: \"/main\",\n        cards: cardsList,\n        onEditAvatar: handleEditAvatarClick,\n        onEditProfile: handleEditProfileClick,\n        onAddPlace: handleAddPlaceClick,\n        onCardClick: handleCardClick,\n        onCardLike: handleCardLike,\n        onCardDelete: handleDeleteButtonClick\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n      isOpen: isEditProfilePopupOpen,\n      onClose: closeAllPopups,\n      onUpdateUser: handleUpdateUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n      isOpen: isEditAvatarPopupOpen,\n      onClose: closeAllPopups,\n      onUpdateAvatar: handleUpdateAvatar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n      isOpen: isAddPlacePopupOpen,\n      onClose: closeAllPopups,\n      onAddPlace: handleAddPlaceSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ConfirmationPopup, {\n      card: selectedCardDelete,\n      isOpen: isDeleteConfirmPopupOpen,\n      onCardDelete: handleCardDelete,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n      card: selectedCard,\n      isOpen: isImagePopupOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n      isSuccess: isSuccess,\n      isOpen: isInfotooltipOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"XAOe7owgefOrTVXb/z2K34mbyWU=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/juliatuvaleva/Desktop/dev/mestoReact/src/components/App.js"],"names":["Header","Main","Footer","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","ConfirmationPopup","Register","Login","ProtectedRoute","InfoTooltip","React","useEffect","useState","CurrentUserContext","api","escKey","auth","Route","Switch","Redirect","useHistory","App","cardsList","setCards","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeleteConfirmPopupOpen","setIsDeleteConfirmPopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","selectedCardDelete","setSelectedCardDelete","currentUser","setCurrentUser","loggedIn","setLoggedIn","isInfotooltipOpen","setisInfotooltipOpen","isSuccess","setIsSuccess","history","userEmail","setUserEmail","getProfileInfo","then","userData","catch","error","console","log","getInitialCards","cardsData","checkToken","close","e","keyCode","closeAllPopups","document","addEventListener","removeEventListener","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteButtonClick","card","handleCardClick","handleUpdateUser","formData","editProfileInfo","handleUpdateAvatar","formLink","editProfilePhoto","handleAddPlaceSubmit","cardForm","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","state","map","c","handleCardDelete","deleteCard","cards","filter","handleLogin","email","password","authorize","data","jwt","token","localStorage","setItem","setUserData","push","handleRegister","register","res","getItem","getContent"],"mappings":"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","sourcesContent":["import Header from './Header'\nimport Main from './Main'\nimport Footer from './Footer'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport ImagePopup from './ImagePopup'\nimport ConfirmationPopup from './ConfirmationPopup'\nimport Register from './Register'\nimport Login from './Login'\nimport ProtectedRoute from './ProtectedRoute'\nimport InfoTooltip from './InfoTooltip'\nimport React, { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport {api} from '../utils/api.js';\nimport {escKey} from '../utils/constant.js';\nimport * as auth from '../auth'\nimport {Route, Switch,Redirect, useHistory } from 'react-router-dom';\n\nfunction App () {\n  const [cardsList, setCards] = useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isDeleteConfirmPopupOpen, setIsDeleteConfirmPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [selectedCardDelete, setSelectedCardDelete] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [isInfotooltipOpen, setisInfotooltipOpen] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const history = useHistory();\n  const [userEmail, setUserEmail] = useState(null);\n  useEffect(()=>{\n    api.getProfileInfo()\n      .then((userData) => {\n          setCurrentUser(userData);\n      })\n      .catch( (error) => {\n          console.log(error);\n      });\n\n    api.getInitialCards()\n    .then((cardsData) => {\n        setCards(cardsData);\n      })\n    .catch( (error) => {\n        console.log(error);\n    });\n\n    checkToken();\n\n  }, [])\n  \n  useEffect(() => {\n    const close = (e) => {\n      if(e.keyCode === escKey){\n        closeAllPopups()\n      }\n    }\n    document.addEventListener('keydown', close)\n    return () => document.removeEventListener('keydown', close)\n  },[])\n\n  function handleEditProfileClick () {\n    setIsEditProfilePopupOpen(true)\n  }\n\n  function handleAddPlaceClick () {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick () {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteButtonClick (card) {\n    setIsDeleteConfirmPopupOpen(true);\n    setSelectedCardDelete(card);\n  }\n\n  function handleCardClick (card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);   \n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditAvatarPopupOpen(false)\n    setIsDeleteConfirmPopupOpen(false)\n    setIsImagePopupOpen(false);\n    setisInfotooltipOpen(false);\n  }\n  \n  function handleUpdateUser (formData) {\n    api.editProfileInfo(formData)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditProfilePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleUpdateAvatar (formLink) {\n    api.editProfilePhoto(formLink)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditAvatarPopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleAddPlaceSubmit (cardForm) {\n    api.addNewCard(cardForm)\n      .then((newCard) => {\n        setCards([newCard, ...cardsList]);\n        setIsAddPlacePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    \n    api.changeLikeCardStatus(card._id, !isLiked)\n       .then((newCard) => {\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        })\n       .catch( (error) => {\n          console.log(error);\n       });\n  } \n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id)\n        .then(() => {\n            setCards((cards) => cards.filter((c) => c._id !== card._id));\n            setIsDeleteConfirmPopupOpen(false);\n        })\n        .catch( (error) => {\n          console.log(error);\n       });\n\n  }\n\n  function handleLogin ({email, password}){\n    auth.authorize(email, password)\n      .then(data => {\n        const jwt  = data.token;\n        localStorage.setItem('jwt', jwt)\n        setLoggedIn(true)\n        setUserData(email);\n        history.push('/main')\n      })\n      .catch(error => console.log(error));\n    \n  }\n\n  function handleRegister({password, email}) {\n    auth.register(password, email)\n      .then(res => {\n        if (res){\n          setIsSuccess(true)\n          setisInfotooltipOpen(true);\n          history.push('/signin');\n        }\n      })\n      .catch(error => {\n        setIsSuccess(false)\n        setisInfotooltipOpen(true);\n        console.log(error);\n      })\n  }\n\n  \n  function checkToken () {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.getContent(jwt)\n        .then(data => {\n          if (data.email) {\n            setUserData(data.email);\n            setLoggedIn(true);\n            history.push('/main');\n          }\n        })\n        .catch(error => console.log(error));\n    }\n    // если у пользователя есть токен в localStorage, \n    // эта функция проверит, действующий он или нет\n    if (localStorage.getItem('jwt')){\n      const jwt = localStorage.getItem('jwt');\n      // здесь будем проверять токен\n      \n    }\n  } \n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n        <Header/>\n\n        <Switch>\n          <Route exact path=\"/signup\">\n            <Register handleRegister={handleRegister}/>\n          </Route>\n          <Route exact path=\"/signin\">\n            <Login handleLogin={handleLogin}/>\n          </Route>\n          <Main exact path=\"/main\"\n            cards={cardsList}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleDeleteButtonClick}\n        />\n        </Switch>\n        \n\n        <Footer/>\n\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateUser={handleUpdateUser}/>\n\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateAvatar={handleUpdateAvatar}/> \n\n        <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                        onClose={closeAllPopups}\n                        onAddPlace={handleAddPlaceSubmit}/>\n\n        <ConfirmationPopup card = {selectedCardDelete}\n                            isOpen={isDeleteConfirmPopupOpen}\n                            onCardDelete={handleCardDelete}\n                            onClose={closeAllPopups}/>\n\n        <ImagePopup card={selectedCard} \n                    isOpen={isImagePopupOpen} \n                    onClose={closeAllPopups}/>\n\n        \n        <InfoTooltip isSuccess={isSuccess} \n                     isOpen={isInfotooltipOpen}\n                     onClose={closeAllPopups}/>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}