{"ast":null,"code":"import _toConsumableArray from\"/Users/juliatuvaleva/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/juliatuvaleva/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import ImagePopup from'./ImagePopup';import ConfirmationPopup from'./ConfirmationPopup';import Register from'./Register';import Login from'./Login';import ProtectedRoute from'./ProtectedRoute';import InfoTooltip from'./InfoTooltip';import React,{useEffect,useState}from'react';import{CurrentUserContext}from'../contexts/CurrentUserContext';import{api}from'../utils/api.js';import{escKey}from'../utils/constant.js';import*as auth from'../auth';import{Route,Switch,useHistory,Redirect}from'react-router-dom';import LoadingSpinner from'./LoadingSpinner';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),cardsList=_useState2[0],setCards=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setIsEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setIsAddPlacePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isEditAvatarPopupOpen=_useState8[0],setIsEditAvatarPopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isDeleteConfirmPopupOpen=_useState10[0],setIsDeleteConfirmPopupOpen=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isImagePopupOpen=_useState12[0],setIsImagePopupOpen=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),selectedCard=_useState14[0],setSelectedCard=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),selectedCardDelete=_useState16[0],setSelectedCardDelete=_useState16[1];var _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),currentUser=_useState18[0],setCurrentUser=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),loggedIn=_useState20[0],setLoggedIn=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isInfotooltipOpen=_useState22[0],setisInfotooltipOpen=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),isSuccess=_useState24[0],setIsSuccess=_useState24[1];var history=useHistory();var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),userEmail=_useState26[0],setUserEmail=_useState26[1];useEffect(function(){api.getProfileInfo().then(function(userData){setCurrentUser(userData);}).catch(function(error){console.log(error);});api.getInitialCards().then(function(cardsData){setCards(cardsData);}).catch(function(error){console.log(error);});},[]);useEffect(function(){var close=function close(e){if(e.keyCode===escKey){closeAllPopups();}};document.addEventListener('keydown',close);return function(){return document.removeEventListener('keydown',close);};},[]);useEffect(function(){checkToken();},[]);function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleDeleteButtonClick(card){setIsDeleteConfirmPopupOpen(true);setSelectedCardDelete(card);}function handleCardClick(card){setSelectedCard(card);setIsImagePopupOpen(true);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsDeleteConfirmPopupOpen(false);setIsImagePopupOpen(false);setisInfotooltipOpen(false);}function handleUpdateUser(formData){api.editProfileInfo(formData).then(function(userData){setCurrentUser(userData);setIsEditProfilePopupOpen(false);}).catch(function(error){console.log(error);});}function handleUpdateAvatar(formLink){api.editProfilePhoto(formLink).then(function(userData){setCurrentUser(userData);setIsEditAvatarPopupOpen(false);}).catch(function(error){console.log(error);});}function handleAddPlaceSubmit(cardForm){api.addNewCard(cardForm).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cardsList)));setIsAddPlacePopupOpen(false);}).catch(function(error){console.log(error);});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(error){console.log(error);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});setIsDeleteConfirmPopupOpen(false);}).catch(function(error){console.log(error);});}function handleLogin(_ref){var email=_ref.email,password=_ref.password;auth.authorize(email,password).then(function(data){var jwt=data.token;localStorage.setItem('jwt',jwt);setLoggedIn(true);setUserEmail(email);history.push('/');}).catch(function(error){return console.log(error);});}function handleRegister(_ref2){var password=_ref2.password,email=_ref2.email;auth.register(password,email).then(function(res){if(res){setIsSuccess(true);setisInfotooltipOpen(true);history.push('/signin');}}).catch(function(error){setIsSuccess(false);setisInfotooltipOpen(true);console.log(error);});}function checkToken(){var jwt=localStorage.getItem('jwt');if(jwt){auth.getContent(jwt).then(function(data){setUserEmail(data.data.email);setLoggedIn(true);history.push('/');}).catch(function(error){return console.log(error);});}else{setLoggedIn(false);}}function handleLogout(e){setUserEmail(null);setLoggedIn(false);localStorage.removeItem('jwt');}if(loggedIn===null){return/*#__PURE__*/_jsx(LoadingSpinner,{});}return/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{isSuccess:isSuccess,loggedIn:loggedIn,userEmail:userEmail,handleLogout:handleLogout}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin})}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/\",cards:cardsList,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleDeleteButtonClick,loggedIn:loggedIn,component:Main}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(ConfirmationPopup,{card:selectedCardDelete,isOpen:isDeleteConfirmPopupOpen,onCardDelete:handleCardDelete,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,isOpen:isImagePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isSuccess:isSuccess,isOpen:isInfotooltipOpen,onClose:closeAllPopups})]});}export default App;","map":{"version":3,"sources":["/Users/juliatuvaleva/Desktop/dev/react-mesto-auth/src/components/App.js"],"names":["Header","Main","Footer","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","ConfirmationPopup","Register","Login","ProtectedRoute","InfoTooltip","React","useEffect","useState","CurrentUserContext","api","escKey","auth","Route","Switch","useHistory","Redirect","LoadingSpinner","App","cardsList","setCards","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeleteConfirmPopupOpen","setIsDeleteConfirmPopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","selectedCardDelete","setSelectedCardDelete","currentUser","setCurrentUser","loggedIn","setLoggedIn","isInfotooltipOpen","setisInfotooltipOpen","isSuccess","setIsSuccess","history","userEmail","setUserEmail","getProfileInfo","then","userData","catch","error","console","log","getInitialCards","cardsData","close","e","keyCode","closeAllPopups","document","addEventListener","removeEventListener","checkToken","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteButtonClick","card","handleCardClick","handleUpdateUser","formData","editProfileInfo","handleUpdateAvatar","formLink","editProfilePhoto","handleAddPlaceSubmit","cardForm","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","state","map","c","handleCardDelete","deleteCard","cards","filter","handleLogin","email","password","authorize","data","jwt","token","localStorage","setItem","push","handleRegister","register","res","getItem","getContent","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import Header from './Header'\nimport Main from './Main'\nimport Footer from './Footer'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport ImagePopup from './ImagePopup'\nimport ConfirmationPopup from './ConfirmationPopup'\nimport Register from './Register'\nimport Login from './Login'\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip'\nimport React, { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport {api} from '../utils/api.js';\nimport {escKey} from '../utils/constant.js';\nimport * as auth from '../auth'\nimport {Route, Switch, useHistory, Redirect } from 'react-router-dom';\nimport LoadingSpinner from './LoadingSpinner'\n\nfunction App () {\n  const [cardsList, setCards] = useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isDeleteConfirmPopupOpen, setIsDeleteConfirmPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [selectedCardDelete, setSelectedCardDelete] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [loggedIn, setLoggedIn] = useState(null);\n  const [isInfotooltipOpen, setisInfotooltipOpen] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const history = useHistory();\n  const [userEmail, setUserEmail] = useState(null);\n\n  useEffect(()=>{\n    api.getProfileInfo()\n      .then((userData) => {\n          setCurrentUser(userData);\n      })\n      .catch( (error) => {\n          console.log(error);\n      });\n\n    api.getInitialCards()\n    .then((cardsData) => {\n        setCards(cardsData);\n      })\n    .catch( (error) => {\n        console.log(error);\n    });\n  }, [])\n  \n  useEffect(() => {\n    const close = (e) => {\n      if(e.keyCode === escKey){\n        closeAllPopups()\n      }\n    }\n    document.addEventListener('keydown', close)\n    return () => document.removeEventListener('keydown', close)\n  },[])\n\n  useEffect(() => {\n    checkToken();\n  },[])\n\n\n  function handleEditProfileClick () {\n    setIsEditProfilePopupOpen(true)\n  }\n\n  function handleAddPlaceClick () {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick () {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteButtonClick (card) {\n    setIsDeleteConfirmPopupOpen(true);\n    setSelectedCardDelete(card);\n  }\n\n  function handleCardClick (card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);   \n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditAvatarPopupOpen(false)\n    setIsDeleteConfirmPopupOpen(false)\n    setIsImagePopupOpen(false);\n    setisInfotooltipOpen(false);\n  }\n  \n  function handleUpdateUser (formData) {\n    api.editProfileInfo(formData)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditProfilePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleUpdateAvatar (formLink) {\n    api.editProfilePhoto(formLink)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditAvatarPopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleAddPlaceSubmit (cardForm) {\n    api.addNewCard(cardForm)\n      .then((newCard) => {\n        setCards([newCard, ...cardsList]);\n        setIsAddPlacePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    \n    api.changeLikeCardStatus(card._id, !isLiked)\n       .then((newCard) => {\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        })\n       .catch( (error) => {\n          console.log(error);\n       });\n  } \n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id)\n        .then(() => {\n            setCards((cards) => cards.filter((c) => c._id !== card._id));\n            setIsDeleteConfirmPopupOpen(false);\n        })\n        .catch((error) => {\n          console.log(error);\n       });\n\n  }\n\n  function handleLogin ({email, password}){\n    auth.authorize(email, password)\n      .then(data => {\n        const jwt  = data.token;\n        localStorage.setItem('jwt', jwt)\n        setLoggedIn(true)\n        setUserEmail(email);\n        history.push('/')\n      })\n      .catch(error => console.log(error));  \n  }\n\n  function handleRegister({password, email}) {\n    auth.register(password, email)\n      .then(res => {\n        if (res){\n          setIsSuccess(true)\n          setisInfotooltipOpen(true);\n          history.push('/signin');\n        }\n      })\n      .catch(error => {\n        setIsSuccess(false)\n        setisInfotooltipOpen(true);\n        console.log(error);\n      })\n  }\n\n  \n  function checkToken () {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.getContent(jwt)\n        .then((data) => {\n          setUserEmail(data.data.email);\n          setLoggedIn(true);\n          history.push('/');\n        })\n        .catch(error => console.log(error));\n    } else {\n      setLoggedIn(false);\n    }\n  } \n\n  function handleLogout(e) {\n    setUserEmail(null);\n    setLoggedIn(false);\n    localStorage.removeItem('jwt');\n  }\n\n  if (loggedIn===null){\n    return <LoadingSpinner/>\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n        <Header isSuccess={isSuccess}\n                loggedIn={loggedIn}\n                userEmail={userEmail}\n                handleLogout={handleLogout}/>\n\n        <Switch>\n          <Route path=\"/signup\">\n            <Register handleRegister={handleRegister}/>\n          </Route>\n\n          <Route path=\"/signin\">\n            <Login handleLogin={handleLogin}/>\n          </Route>\n          \n\n          <ProtectedRoute path=\"/\"\n                cards={cardsList}\n                onEditAvatar={handleEditAvatarClick}\n                onEditProfile={handleEditProfileClick}\n                onAddPlace={handleAddPlaceClick}\n                onCardClick={handleCardClick}\n                onCardLike={handleCardLike}\n                onCardDelete={handleDeleteButtonClick}\n                loggedIn={loggedIn}\n                component={Main}/>\n\n          <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n          </Route>\n        </Switch>\n\n        <Footer/>\n\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateUser={handleUpdateUser}/>\n\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateAvatar={handleUpdateAvatar}/> \n\n        <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                        onClose={closeAllPopups}\n                        onAddPlace={handleAddPlaceSubmit}/>\n\n        <ConfirmationPopup card = {selectedCardDelete}\n                            isOpen={isDeleteConfirmPopupOpen}\n                            onCardDelete={handleCardDelete}\n                            onClose={closeAllPopups}/>\n\n        <ImagePopup card={selectedCard} \n                    isOpen={isImagePopupOpen} \n                    onClose={closeAllPopups}/>\n\n        \n        <InfoTooltip isSuccess={isSuccess} \n                     isOpen={isInfotooltipOpen}\n                     onClose={closeAllPopups}/>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}