{"ast":null,"code":"var _jsxFileName = \"/Users/juliatuvaleva/Desktop/dev/mestoReact/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ImagePopup from './ImagePopup';\nimport ConfirmationPopup from './ConfirmationPopup';\nimport Register from './Register';\nimport Login from './Login';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\nimport React, { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport { api } from '../utils/api.js';\nimport { escKey } from '../utils/constant.js';\nimport * as auth from '../auth';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [cardsList, setCards] = useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isDeleteConfirmPopupOpen, setIsDeleteConfirmPopupOpen] = useState(false);\n  const [isInfotooltipOpen, setisInfotooltipOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [selectedCardDelete, setSelectedCardDelete] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [loggedIn, setLoggedIn] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    api.getProfileInfo().then(userData => {\n      setCurrentUser(userData);\n    }).catch(error => {\n      console.log(error);\n    });\n    api.getInitialCards().then(cardsData => {\n      setCards(cardsData);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n  useEffect(() => {\n    const close = e => {\n      if (e.keyCode === escKey) {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener('keydown', close);\n    return () => document.removeEventListener('keydown', close);\n  }, []);\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteButtonClick(card) {\n    setIsDeleteConfirmPopupOpen(true);\n    setSelectedCardDelete(card);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsDeleteConfirmPopupOpen(false);\n    setIsImagePopupOpen(false);\n  }\n\n  function handleUpdateUser(formData) {\n    api.editProfileInfo(formData).then(userData => {\n      setCurrentUser(userData);\n      setIsEditProfilePopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleUpdateAvatar(formLink) {\n    api.editProfilePhoto(formLink).then(userData => {\n      setCurrentUser(userData);\n      setIsEditAvatarPopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleAddPlaceSubmit(cardForm) {\n    api.addNewCard(cardForm).then(newCard => {\n      setCards([newCard, ...cardsList]);\n      setIsAddPlacePopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, !isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      setCards(cards => cards.filter(c => c._id !== card._id));\n      setIsDeleteConfirmPopupOpen(false);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n\n  function handleRegister({\n    password,\n    email\n  }) {\n    auth.register(password, email).then(res => {\n      if (res) {\n        setisInfotooltipOpen(true);\n        history.push('/signin');\n      }\n    }).catch(error => console.error(error));\n  }\n\n  function tokenCheck() {\n    // если у пользователя есть токен в localStorage, \n    // эта функция проверит, действующий он или нет\n    if (localStorage.getItem('jwt')) {\n      const jwt = localStorage.getItem('jwt'); // здесь будем проверять токен\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/signup\",\n        children: /*#__PURE__*/_jsxDEV(Register, {\n          handleRegister: handleRegister\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/signin\",\n        children: /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Main, {\n        exact: true,\n        path: \"/main\",\n        cards: cardsList,\n        onEditAvatar: handleEditAvatarClick,\n        onEditProfile: handleEditProfileClick,\n        onAddPlace: handleAddPlaceClick,\n        onCardClick: handleCardClick,\n        onCardLike: handleCardLike,\n        onCardDelete: handleDeleteButtonClick\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n      isOpen: isEditProfilePopupOpen,\n      onClose: closeAllPopups,\n      onUpdateUser: handleUpdateUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n      isOpen: isEditAvatarPopupOpen,\n      onClose: closeAllPopups,\n      onUpdateAvatar: handleUpdateAvatar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n      isOpen: isAddPlacePopupOpen,\n      onClose: closeAllPopups,\n      onAddPlace: handleAddPlaceSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ConfirmationPopup, {\n      card: selectedCardDelete,\n      isOpen: isDeleteConfirmPopupOpen,\n      onCardDelete: handleCardDelete,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n      card: selectedCard,\n      isOpen: isImagePopupOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n      isOpen: isInfotooltipOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"lpWt4NvMoK7il+FeQ4KJaMiCkRU=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/juliatuvaleva/Desktop/dev/mestoReact/src/components/App.js"],"names":["Header","Main","Footer","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","ConfirmationPopup","Register","Login","ProtectedRoute","InfoTooltip","React","useEffect","useState","CurrentUserContext","api","escKey","auth","Route","Switch","Redirect","useHistory","App","cardsList","setCards","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeleteConfirmPopupOpen","setIsDeleteConfirmPopupOpen","isInfotooltipOpen","setisInfotooltipOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","selectedCardDelete","setSelectedCardDelete","currentUser","setCurrentUser","loggedIn","setLoggedIn","history","getProfileInfo","then","userData","catch","error","console","log","getInitialCards","cardsData","close","e","keyCode","closeAllPopups","document","addEventListener","removeEventListener","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteButtonClick","card","handleCardClick","handleUpdateUser","formData","editProfileInfo","handleUpdateAvatar","formLink","editProfilePhoto","handleAddPlaceSubmit","cardForm","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","state","map","c","handleCardDelete","deleteCard","cards","filter","handleLogin","handleRegister","password","email","register","res","push","tokenCheck","localStorage","getItem","jwt"],"mappings":"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","sourcesContent":["import Header from './Header'\nimport Main from './Main'\nimport Footer from './Footer'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport ImagePopup from './ImagePopup'\nimport ConfirmationPopup from './ConfirmationPopup'\nimport Register from './Register'\nimport Login from './Login'\nimport ProtectedRoute from './ProtectedRoute'\nimport InfoTooltip from './InfoTooltip'\nimport React, { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport {api} from '../utils/api.js';\nimport {escKey} from '../utils/constant.js';\nimport * as auth from '../auth'\nimport {Route, Switch,Redirect, useHistory } from 'react-router-dom';\n\nfunction App () {\n  const [cardsList, setCards] = useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isDeleteConfirmPopupOpen, setIsDeleteConfirmPopupOpen] = useState(false);\n  const [isInfotooltipOpen, setisInfotooltipOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [selectedCardDelete, setSelectedCardDelete] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [loggedIn, setLoggedIn] = useState(false);\n  const history = useHistory();\n  useEffect(()=>{\n    api.getProfileInfo()\n      .then((userData) => {\n          setCurrentUser(userData);\n      })\n      .catch( (error) => {\n          console.log(error);\n      });\n\n    api.getInitialCards()\n    .then((cardsData) => {\n        setCards(cardsData);\n      })\n    .catch( (error) => {\n        console.log(error);\n    });\n  }, [])\n  \n  useEffect(() => {\n    const close = (e) => {\n      if(e.keyCode === escKey){\n        closeAllPopups()\n      }\n    }\n    document.addEventListener('keydown', close)\n    return () => document.removeEventListener('keydown', close)\n  },[])\n\n  function handleEditProfileClick () {\n    setIsEditProfilePopupOpen(true)\n  }\n\n  function handleAddPlaceClick () {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick () {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleDeleteButtonClick (card) {\n    setIsDeleteConfirmPopupOpen(true);\n    setSelectedCardDelete(card);\n  }\n\n  function handleCardClick (card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);   \n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditAvatarPopupOpen(false)\n    setIsDeleteConfirmPopupOpen(false)\n    setIsImagePopupOpen(false);\n  }\n  \n  function handleUpdateUser (formData) {\n    api.editProfileInfo(formData)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditProfilePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleUpdateAvatar (formLink) {\n    api.editProfilePhoto(formLink)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setIsEditAvatarPopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleAddPlaceSubmit (cardForm) {\n    api.addNewCard(cardForm)\n      .then((newCard) => {\n        setCards([newCard, ...cardsList]);\n        setIsAddPlacePopupOpen(false)\n       })\n      .catch( (error) => {\n          console.log(error);\n      });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    \n    api.changeLikeCardStatus(card._id, !isLiked)\n       .then((newCard) => {\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        })\n       .catch( (error) => {\n          console.log(error);\n       });\n  } \n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id)\n        .then(() => {\n            setCards((cards) => cards.filter((c) => c._id !== card._id));\n            setIsDeleteConfirmPopupOpen(false);\n        })\n        .catch( (error) => {\n          console.log(error);\n       });\n\n  }\n\n  function handleLogin (){\n    setLoggedIn(true)\n  }\n\n  function handleRegister({password, email}) {\n    auth.register(password, email)\n      .then(res => {\n        if (res){\n          setisInfotooltipOpen(true);\n          history.push('/signin');\n        }\n      })\n      .catch(error => console.error(error))\n  }\n\n  \n  function tokenCheck () {\n    // если у пользователя есть токен в localStorage, \n    // эта функция проверит, действующий он или нет\n    if (localStorage.getItem('jwt')){\n      const jwt = localStorage.getItem('jwt');\n      // здесь будем проверять токен\n      \n    }\n  } \n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n        <Header/>\n\n        <Switch>\n          <Route exact path=\"/signup\">\n            <Register handleRegister={handleRegister}/>\n          </Route>\n          <Route exact path=\"/signin\">\n            <Login />\n          </Route>\n          <Main exact path=\"/main\"\n            cards={cardsList}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleDeleteButtonClick}\n        />\n        </Switch>\n        \n\n        <Footer/>\n\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateUser={handleUpdateUser}/>\n\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} \n                          onClose={closeAllPopups} \n                          onUpdateAvatar={handleUpdateAvatar}/> \n\n        <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                        onClose={closeAllPopups}\n                        onAddPlace={handleAddPlaceSubmit}/>\n\n        <ConfirmationPopup card = {selectedCardDelete}\n                            isOpen={isDeleteConfirmPopupOpen}\n                            onCardDelete={handleCardDelete}\n                            onClose={closeAllPopups}/>\n\n        <ImagePopup card={selectedCard} isOpen={isImagePopupOpen} onClose={closeAllPopups}/>\n\n        \n        <InfoTooltip isOpen={isInfotooltipOpen} onClose={closeAllPopups}/>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}